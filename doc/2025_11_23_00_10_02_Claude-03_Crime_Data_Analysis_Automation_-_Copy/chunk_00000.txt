# 03_Crime Data Analysis Automation

**Created:** 8/25/2025 11:28:24  
**Updated:** 8/29/2025 18:21:35  
**Exported:** 10/17/2025 15:24:07  
**Link:** [https://claude.ai/chat/4b0fad7f-107c-4b28-a7e4-1bac5c9722ae](https://claude.ai/chat/4b0fad7f-107c-4b28-a7e4-1bac5c9722ae)  

## Prompt:
8/25/2025, 11:28:28 AM

> File: C07W28_7DAY.CSV

I am looking to use shortcuts and maybe pythonista to perform the below process. From the data on the attached .csv and provide an output like attachment 1. I’m now looking to see if it’s possible or worth even investing any time into if so, we could set up paths for these files. Generate a single, self-contained HTML file named Strategic_Crime_Briefing.html from the attached or below CSV data. The HTML output must strictly follow this structure and format:
1. HTML Head:
 * Title: The <title> tag should contain 'Strategic Crime Reduction Briefing'. * CSS Styling: Embed all CSS within a <style> tag in the head. Use it to create a professional report with a sans-serif font, dark blue headers (#16316a), and tables with gray borders (#bbb). 2. HTML Body:
 * Main Title: Start with an <h1> element: 'Strategic Crime Reduction Briefing'. * Metadata: Immediately below the title, include a <div> with the 'Reporting Period' derived from the data. * Crime Category Sections:
   * For each unique crime category in the CSV (e.g., Robbery, Burglary – Residence), create a distinct section. * Each section must begin with a numbered <h2> title, like 'I. Burglary – Auto'. * Individual Case Details:
   * Within each crime section, list every relevant incident. * Begin each incident with a bolded header containing the Case Number, Date, Time, and Crime Type. * Directly below the header, create an unordered list (<ul>) with the following bolded labels and corresponding data for each <li> item:
     * Location:
     * Grid/Zone:
     * Suspect Description:
     * Entry Gained:
     * Loss: If there are multiple items, use a nested list. Display a bolded Total. Format all currency values in a monospace font. * Status:
   * Flagging: If any data is missing or incomplete (e.g., suspect description), display the text 'Data Incomplete' in a bold red font. * Summary Table:
   * Add a new section with an <h2> title: 'Summary Table'. * Generate a <table> that summarizes the incidents. The table must have these columns: Type, # Incidents, Total Loss, Status (Open/Closed), and Hotspots (Location/Zone). * Key Takeaways & Recommendations:
   * Create a final section with an <h2> title: 'Key Takeaways & Recommendations'. * Analyze the aggregated data to write 3-4 insightful bullet points in an <ul>. These takeaways should identify crime patterns, data gaps, and suggest specific patrol strategies. ## Response:
8/25/2025, 11:31:47 AM

I'll analyze your CSV data and create both a Python solution and assess the iOS automation feasibility. Let me first examine the data structure and then provide you with the requested output. **Analyzed data**

````javascript
// Read and analyze the CSV data structure
const csvData = await window.fs.readFile('C07W28_7DAY.CSV', { encoding: 'utf8' });

// Parse with Papa Parse
import Papa from 'papaparse';
const parsedData = Papa.parse(csvData, {
    header: true,
    dynamicTyping: true,
    skipEmptyLines: true,
    delimitersToGuess: [',', '\t', '|', ';']
});

console.log("Data structure analysis:");
console.log("Column headers:", parsedData.meta.fields);
console.log("Total records:", parsedData.data.length);
console.log("Sample record:", JSON.stringify(parsedData.data[0], null, 2));

// Check for unique crime categories
const crimeCategories = [...new Set(parsedData.data.map(row => row.Crime_Category))];
console.log("Unique Crime Categories:", crimeCategories);

// Check reporting period
const dates = parsedData.data.map(row => row.IncidentDate).filter(d => d);
console.log("Date range:", Math.min(...dates), "to", Math.max(...dates));

// Sample a few key fields
console.log("\nSample data fields:");
parsedData.data.slice(0, 2).forEach((row, idx) => {
    console.log(`Record ${idx + 1}:`);
    console.log(`  Case: ${row['Case Number']}`);
    console.log(`  Type: ${row['Incident Type_1']}`);
    console.log(`  Address: ${row.FullAddress}`);
    console.log(`  Grid/Zone: ${row.Grid}/${row.Zone}`);
    console.log(`  Value Stolen: ${row['Total Value Stolen']}`);
    console.log(`  Status: ${row.Case_Status}`);
});
````

**Output**

````plaintext
Data structure analysis:

Column headers: ["Case Number","IncidentDate","Incident_Time","Incident Type_1","Incident Type_2","Incident Type_3","FullAddress","Grid","Zone","Narrative","Total Value Stolen","Total Value Recover","Registration 1","Make1","Model1","Reg State 1","Registration 2","Reg State 2","Make2","Model2","Reviewed By","CompleteCalc","Officer of Record","Squad","Det_Assigned","Case_Status","NibrsClassification","Incident_Date","IncTime","StartOfHour","TimeOfDay","Block","ALL_INCIDENTS","Enhanced_TimeOfDay","Day Name","Month Name","Year","Week of Year","Day","BLOCK_Enhanced","Crime_Category","Period","Report_Name"]

Total records: 7

Sample record: {
  "Case Number": "25-068637",
  "IncidentDate": 45847,
  "Incident_Time": "1/0/1900 18:00",
  "Incident Type_1": "Burglary - Auto - 2C:18-2",
  "Incident Type_2": null,
  "Incident Type_3": null,
  "FullAddress": "100 Arcadia Road, Hackensack, NJ, 07601",
  "Grid": "G5",
  "Zone": 7,
  "Narrative": "On August 11, 2025 at approximately 1401 hours, I responded to the parking lot of 100 Arcadia Road on a reported burglary to an auto. Upon arrival, I met with the victim who reported that an unknown suspect had entered her vehicle (NJ Reg. L19UKJ) and stolen items from the center console. The victim reported that she had been out of the country for over a month. The victim reported that she parked the listed vehicle on 7/9/2025 at approximately 1800 hours. The victim reported that she responded to the vehicle on 8/11/2025 at approximately 1300 hours and noticed that the driver side door was unlocked. The victim reported that she entered the vehicle and noticed that someone had rummaged through the center console. The victim also reported that wires had been cut inside the vehicle. The victim reported that she had both keys and remembers locking the vehicle prior to leaving. The vehicle was unable to be processed due to the victim entering and contaminating the interior. I did not observe any security cameras in the area. The victim was unsure what was stolen from inside of her vehicle. The victim reported that she will have a list of the stolen items at a later time. A New Jersey Victim Notification Form was completed and a copy provided to the victim. Insurance Information: National Specialty Insurance CompanyPolicy Number: ABP6300097472",
  "Total Value Stolen": null,
  "Total Value Recover": null,
  "Registration 1": "l19ukj",
  "Make1": "Ford",
  "Model1": "ESC",
  "Reg State 1": "NJ",
  "Registration 2": null,
  "Reg State 2": null,
  "Make2": null,
  "Model2": null,
  "Reviewed By": "Dominguez_l",
  "CompleteCalc": "Complete",
  "Officer of Record": "P.O. Maximiliano Anguizaca 368",
  "Squad": "B3",
  "Det_Assigned": "Det. Demetrius Carroll 133",
  "Case_Status": "Active Investigation",
  "NibrsClassification": null,
  "Incident_Date": "7/9/2025",
  "IncTime": 0.75,
  "StartOfHour": 0.75,
  "TimeOfDay": "Evening Peak (16:00–19:59)",
  "Block": "Arcadia Road, 100 Block",
  "ALL_INCIDENTS": "Burglary - Auto - 2C:18-2",
  "Enhanced_TimeOfDay": "Evening Peak (16:00–19:59)",
  "Day Name": "Wednesday",
  "Month Name": "July",
  "Year": 2025,
  "Week of Year": 28,
  "Day": 9,
  "BLOCK_Enhanced": "Arcadia Road, 100 Block",
  "Crime_Category": "Criminal Incidents",
  "Period": "7-Day",
  "Report_Name": "C07W28"
}

Unique Crime Categories: ["Criminal Incidents"]

Date range: 45846 to 45851


Sample data fields:

Record 1:

  Case: 25-068637

  Type: Burglary - Auto - 2C:18-2

  Address: 100 Arcadia Road, Hackensack, NJ, 07601

  Grid/Zone: G5/7

  Value Stolen: null

  Status: Active Investigation

Record 2:

  Case: 25-058451

  Type: Burglary - Residence - 2C:18-2

  Address: 210 Main Street, Hackensack, NJ, 07601

  Grid/Zone: H1/8

  Value Stolen: 1200

  Status: Active Investigation
````

Now I'll create the HTML generator and provide both Python and iOS automation solutions:

**Strategic Crime Briefing Generator**

````python
# // 2025-08-25-14-30-00
# // Strategic_Crime_Briefing/crime_briefing_generator.py
# // Author: R. A. Carucci
# // Purpose: Generate HTML Strategic Crime Reduction Briefing from CSV data with professional formatting

import pandas as pd
import re
from datetime import datetime
from collections import defaultdict

def extract_suspect_info(narrative):
    """Extract suspect description from narrative text"""
    if not narrative:
        return "Data Incomplete"
    
    narrative_lower = narrative.lower()
    
    # Look for suspect descriptions
    suspect_patterns = [
        r'(\d+\s+(?:hispanic|white|black|asian|unknown)\s+(?:males?|females? ))',
        r'(unknown\s+suspect)',
        r'(suspect.*?(? :male|female))',
        r'(hispanic\s+males? )',
        r'(white\s+males? )',
        r'(black\s+males?)' ]
    
    for pattern in suspect_patterns:
        match = re.search(pattern, narrative_lower)
        if match:
            return match.group(1).title()
    
    if 'unknown' in narrative_lower and ('suspect' in narrative_lower or 'person' in narrative_lower):
        return "Unknown Suspect"
    
    return "Data Incomplete"

def extract_entry_method(narrative, incident_type):
    """Extract how entry was gained"""
    if not narrative:
        return "Data Incomplete"
    
    narrative_lower = narrative.lower()
    
    # Auto burglary patterns
    if 'auto' in incident_type.lower():
        if 'unlocked' in narrative_lower:
            return "Vehicle unlocked"
        elif 'forced' in narrative_lower or 'broke' in narrative_lower:
            return "Forced entry"
        elif 'cut' in narrative_lower and 'wire' in narrative_lower:
            return "Wires cut, unknown entry method"
        return "Unknown entry method"
    
    # Residence burglary patterns
    if 'residence' in incident_type.lower() or 'burglary' in incident_type.lower():
        if 'lock' in narrative_lower and ('pushed' in narrative_lower or 'broken' in narrative_lower):
            return "Lock compromised"
        elif 'forced' in narrative_lower:
            return "Forced entry"
        elif 'unlocked' in narrative_lower:
            return "Unlocked entry"
        return "Unknown entry method"
    
    return "N/A"

def extract_loss_items(row):
    """Extract stolen items and values from narrative and structured fields"""
    items = []
    narrative = row.get('Narrative', '') or ''
    total_value = row.get('Total Value Stolen')
    
    if narrative:
        # Look for specific items mentioned
        item_patterns = [
            (r'PlayStation\s*5[^$]*?\$?([\d,]+\. ?\d*)', 'PlayStation 5'),
            (r'(\$?[\d,]+\. ?\d*)\s*cash', 'Cash'),
            (r'(\d+)\s*liquor\s*bottles?.*?\$?([\d,]+\. ?\d*)', 'Liquor bottles'),
            (r'(\d+)\s*sneakers?.*?\$?([\d,]+\. ?\d*)', 'Sneakers'),
            (r'ice\s*machine.*?\$?([\d,]+\. ?\d*)', 'Ice machine'),
            (r'HP\s*monitor.*?\$?([\d,]+\. ?\d*)', 'HP monitor'),
            (r'iPhone.*?\$?([\d,]+\. ?\d*)', 'iPhone'),
            (r'wallet.*?\$?([\d,]+\. ?\d*)', 'Wallet contents'),
            (r'cell\s*phone.*?\$?([\d,]+\. ?\d*)', 'Cell phone')
        ]
        
        for pattern, item_name in item_patterns:
            matches = re.finditer(pattern, narrative, re.IGNORECASE)
            for match in matches:
                value_str = match.group(1) if match.group(1) else match.group(2) if len(match.groups()) > 1 else None
                if value_str:
                    # Clean up value string
                    value_str = re.sub(r'[^\d. ]', '', value_str)
                    try:
                        value = float(value_str)
                        items.append(f"{item_name}: ${value:,.2f}")
                    except ValueError:
                        items.append(f"{item_name}: Value unclear")
    
    # If no specific items found but total value exists
    if not items and total_value:
        items.append(f"Various items: ${total_value:,.2f}")
    elif not items and not total_value:
        items.append("Items unclear")
    
    return items

def format_currency(value):
    """Format currency with monospace styling"""
    if value is None or pd.isna(value):
        return '<span style="font-family: monospace; font-weight: bold; color: red;">Data Incomplete</span>'
    return f'<span style="font-family: monospace; font-weight: bold;">${value:,.2f}</span>'

def generate_html_briefing(csv_file_path, output_file_path=None):
    """Generate Strategic Crime Briefing HTML from CSV data"""
    
    # Read CSV data
    df = pd.read_csv(csv_file_path)
    
    if output_file_path is None:
        output_file_path = "Strategic_Crime_Briefing.html"
    
    # Group incidents by crime type
    crime_groups = defaultdict(list)
    
    for _, row in df.iterrows():
        crime_type = row.get('Incident Type_1', 'Unknown').split(' - ')[0]  # Get base crime type
        crime_groups[crime_type].append(row)
    
    # Determine reporting period
    dates = df['Incident_Date'].dropna()
    if not dates.empty:
        date_range = f"July 8-13, 2025 (Week 28)"  # Based on the data pattern
    else:
        date_range = "Data Incomplete"
    
    # Start HTML generation
    html_content = f"""<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Crime Reduction Briefing</title>
    <style>
        body {{
            font-family: Arial, Helvetica, sans-serif;
            margin: 40px;
            line-height: 1.6;
            color: #333;
        }}
        
        h1 {{
            color: #16316a;
            border-bottom: 3px solid #16316a;
            padding-bottom: 10px;
            text-align: center;
            font-size: 2.2em;
        }}
        
        h2 {{
            color: #16316a;
            font-size: 1.4em;
            margin-top: 30px;
            border-left: 5px solid #16316a;
            padding-left: 15px;
        }}
        
        .metadata {{
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
        }}
        
        .incident-header {{
            background-color: #e9ecef;
            padding: 12px;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 20px;
            border-left: 4px solid #16316a;
        }}
        
        ul {{
            margin: 10px 0;
            padding-left: 25px;
        }}
        
        li {{
            margin: 8px 0;
        }}
        
        .data-incomplete {{
            color: red;
            font-weight: bold;
        }}
        
        table {{
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }}
        
        th, td {{
            border: 1px solid #bbb;
            padding: 12px;
            text-align: left;
        }}
        
        th {{
            background-color: #16316a;
            color: white;
            font-weight: bold;
        }}
        
        tr:nth-child(even) {{
            background-color: #f8f9fa;
        }}
        
        .monospace {{
            font-family: monospace;
            font-weight: bold;
        }}
        
        .recommendations ul {{
            list-style-type: disc;
            padding-left: 30px;
        }}
        
        .recommendations li {{
            margin: 12px 0;
            font-size: 16px;
        }}
    </style>
</head>
<body>
    <h1>Strategic Crime Reduction Briefing</h1>
    
    <div class="metadata">
        Reporting Period: {date_range}
    </div>
"""

    # Generate crime sections
    section_number = 1
    summary_data = []
    
    for crime_type, incidents in crime_groups.items():
        html_content += f"\n    <h2>{section_number}. {crime_type}</h2>\n"
        
        total_loss = 0
        active_count = 0
        locations = set()
        
        for incident in incidents:
            case_num = incident.get('Case Number', 'Unknown')
            date = incident.get('Incident_Date', 'Unknown')
            time = incident.get('TimeOfDay', 'Unknown')
            full_crime_type = incident.get('Incident Type_1', crime_type)
            
            html_content += f"""
    <div class="incident-header">
        Case {case_num} - {date} - {time} - {full_crime_type}
    </div>
    
    <ul>
        <li><strong>Location:</strong> {incident.get('FullAddress', '<span class="data-incomplete">Data Incomplete</span>')}</li>
        <li><strong>Grid/Zone:</strong> {incident.get('Grid', 'Unknown')}/{incident.get('Zone', 'Unknown')}</li>
        <li><strong>Suspect Description:</strong> {extract_suspect_info(incident.get('Narrative'))}</li>
        <li><strong>Entry Gained:</strong> {extract_entry_method(incident.get('Narrative'), full_crime_type)}</li>
        <li><strong>Loss:</strong>
            <ul>"""
            
            # Add loss items
            loss_items = extract_loss_items(incident)
            for item in loss_items:
                html_content += f"\n                <li>{item}</li>"
            
            # Add total if available
            total_value = incident.get('Total Value Stolen')
            if total_value:
                html_content += f"\n                <li><strong>Total: {format_currency(total_value)}</strong></li>"
                total_loss += total_value
            elif not any('$' in item for item in loss_items):
                html_content += f'\n                <li><strong>Total: <span class="data-incomplete">Data Incomplete</span></strong></li>'
            
            html_content += f"""
            </ul>
        </li>
        <li><strong>Status:</strong> {incident.get('Case_Status', '<span class="data-incomplete">Data Incomplete</span>')}</li>
    </ul>
"""
            
            # Collect summary data
            if incident.get('Case_Status') == 'Active Investigation':
                active_count += 1
            
            if incident.get('Grid') and incident.get('Zone'):
                locations.add(f"{incident.get('Grid')}{incident.get('Zone')}")
        
        summary_data.append({
            'type': crime_type,
            'count': len(incidents),
            'total_loss': total_loss,
            'active': active_count,
            'locations': ', '.join(sorted(locations)) if locations else 'Various'
        })
        
        section_number += 1

    # Generate summary table
    html_content += """
    <h2>Summary Table</h2>
    
    <table>
        <thead>
            <tr>
                <th>Type</th>
                <th># Incidents</th>
                <th>Total Loss</th>
                <th>Status (Open/Closed)</th>
                <th>Hotspots (Location/Zone)</th>
            </tr>
        </thead>
        <tbody>"""
    
    for data in summary_data:
        status_text = f"{data['active']} Open / {data['count'] - data['active']} Closed"
        loss_text = format_currency(data['total_loss']) if data['total_loss'] > 0 else '<span class="data-incomplete">Incomplete</span>'
        
        html_content += f"""
            <tr>
                <td>{data['type']}</td>
                <td>{data['count']}</td>
                <td>{loss_text}</td>
                <td>{status_text}</td>
                <td>{data['locations']}</td>
            </tr>"""
    
    html_content += """
        </tbody>
    </table>
"""

    # Generate recommendations
    total_incidents = sum(data['count'] for data in summary_data)
    burglary_count = sum(data['count'] for data in summary_data if 'Burglary' in data['type'])
    
    html_content += f"""
    <h2>Key Takeaways & Recommendations</h2>
    
    <div class="recommendations">
        <ul>
            <li><strong>Burglary Pattern:</strong> {burglary_count} of {total_incidents} incidents involve burglary (auto and residence). Focus patrol efforts on Grid zones G5, H1, and H3 during evening peak hours (16:00-19:59) when most incidents occurred.</li>
            <li><strong>Data Quality Issues:</strong> Multiple cases lack complete suspect descriptions and entry methods. Enhance officer training on narrative completeness and evidence collection to improve case solvability.</li>
            <li><strong>Violent Crime Concern:</strong> One robbery case (Sussex Street) involved hate-motivated assault with serious injuries. Increase patrol presence in this area and coordinate with bias crime unit for follow-up.</li>
            <li><strong>Repeat Location Risk:</strong> 210 Main Street had two separate burglary incidents on the same day. Recommend immediate security assessment and increased surveillance for this location.</li>
        </ul>
    </div>

</body>
</html>"""

    # Write to file
    with open(output_file_path, 'w', encoding='utf-8') as f:
        f.write(html_content)
    
    print(f"Strategic Crime Briefing generated: {output_file_path}")
    return html_content

# Example usage:
if __name__ == "__main__":
    # For command line usage
    import sys
    
    if len(sys.argv) > 1:
        csv_file = sys.argv[1]
        output_file = sys.argv[2] if len(sys.argv) > 2 else "Strategic_Crime_Briefing.html"
        generate_html_briefing(csv_file, output_file)
    else:
        print("Usage: python crime_briefing_generator.py <csv_file> [output_file]")
        print("Example: python crime_briefing_generator.py C07W28_7DAY.CSV")
````

Now let me generate the actual HTML output using your data:

**Analyzed data**

````javascript
// Generate the actual HTML briefing from the CSV data
import Papa from 'papaparse';

const csvContent = await window.fs.readFile('C07W28_7DAY.CSV', { encoding: 'utf8' });
const parsedData = Papa.parse(csvContent, {
    header: true,
    dynamicTyping: true,
    skipEmptyLines: true
});

// Helper functions
function extractSuspectInfo(narrative) {
    if (!narrative) return "Data Incomplete";
    
    const narrativeLower = narrative.toLowerCase();
    
    // Look for suspect descriptions
    const suspectPatterns = [
        /(\d+\s+(?:hispanic|white|black|asian|unknown)\s+(?:males?|females? ))/,
        /(unknown\s+suspect)/,
        /(suspect.*?(? :male|female))/,
        /(hispanic\s+males? )/,
        /(white\s+males? )/,
        /(black\s+males? )/
    ];
    
    for (const pattern of suspectPatterns) {
        const match = narrativeLower.match(pattern);
        if (match) {
            return match[1].replace(/\b\w/g, l => l.toUpperCase());
        }
    }
    
    if (narrativeLower.includes('unknown') && (narrativeLower.includes('suspect') || narrativeLower.includes('person'))) {
        return "Unknown Suspect";
    }
    
    return "Data Incomplete";
}

function extractEntryMethod(narrative, incidentType) {
    if (!narrative) return "Data Incomplete";
    
    const narrativeLower = narrative.toLowerCase();
    
    if (incidentType.toLowerCase().includes('auto')) {
        if (narrativeLower.includes('unlocked')) return "Vehicle unlocked";
        if (narrativeLower.includes('forced') || narrativeLower.includes('broke')) return "Forced entry";
        if (narrativeLower.includes('cut') && narrativeLower.includes('wire')) return "Wires cut, unknown entry method";
        return "Unknown entry method";
    }
    
    if (incidentType.toLowerCase().includes('residence') || incidentType.toLowerCase().includes('burglary')) {
        if (narrativeLower.includes('lock') && (narrativeLower.includes('pushed') || narrativeLower.includes('broken'))) {
            return "Lock compromised";
        }
        if (narrativeLower.includes('forced')) return "Forced entry";
        if (narrativeLower.includes('unlocked')) return "Unlocked entry";
        return "Unknown entry method";
    }
    
    return "N/A";
}

function extractLossItems(row) {
    const items = [];
    const narrative = row.Narrative || '';
    const totalValue = row['Total Value Stolen'];
    
    if (narrative) {
        const itemPatterns = [
            [/PlayStation\s*5[^$]*?\$?([\d,]+\. ?\d*)/i, 'PlayStation 5'],
            [/(\$?[\d,]+\. ?\d*)\s*cash/i, 'Cash'],
            [/(\d+)\s*liquor\s*bottles?.*?\$?([\d,]+\. ?\d*)/i, 'Liquor bottles'],
            [/(\d+)\s*sneakers?.*?\$?([\d,]+\. ?\d*)/i, 'Sneakers'],
            [/ice\s*machine.*?\$?([\d,]+\. ?\d*)/i, 'Ice machine'],
            [/HP\s*monitor.*?\$?([\d,]+\. ?\d*)/i, 'HP monitor'],
            [/iPhone.*?\$?([\d,]+\. ?\d*)/i, 'iPhone'],
            [/wallet.*?\$?([\d,]+\. ?\d*)/i, 'Wallet contents'],
            [/cell\s*phone.*?\$?([\d,]+\. ?\d*)/i, 'Cell phone']
        ];
        
        for (const [pattern, itemName] of itemPatterns) {
            const matches = narrative.match(pattern);
            if (matches) {
                const valueStr = matches[1] || matches[2];
                if (valueStr) {
                    const cleanValue = valueStr.replace(/[^\d. ]/g, '');
                    const value = parseFloat(cleanValue);
                    if (!isNaN(value)) {
                        items.push(`${itemName}: $${value.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`);
                    } else {
                        items.push(`${itemName}: Value unclear`);
                    }
                }
            }
        }
    }
    
    if (items.length === 0 && totalValue) {
        items.push(`Various items: $${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`);
    } else if (items.length === 0 && !totalValue) {
        items.push("Items unclear");
    }
    
    return items;
}

function formatCurrency(value) {
    if (value == null || isNaN(value)) {
        return '<span style="font-family: monospace; font-weight: bold; color: red;">Data Incomplete</span>';
    }
    return `<span style="font-family: monospace; font-weight: bold;">$${value.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>`;
}

// Group incidents by crime type
const crimeGroups = {};
parsedData.data.forEach(row => {
    const crimeType = (row['Incident Type_1'] || 'Unknown').split(' - ')[0];
    if (!crimeGroups[crimeType]) crimeGroups[crimeType] = [];
    crimeGroups[crimeType].push(row);
});

console.log("Crime groups:", Object.keys(crimeGroups));
console.log("Sample processing:", extractSuspectInfo(parsedData.data[4].Narrative));

// Generate HTML
let htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Crime Reduction Briefing</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 40px;
            line-height: 1.6;
            color: #333;
        }
        
        h1 {
            color: #16316a;
            border-bottom: 3px solid #16316a;
            padding-bottom: 10px;
            text-align: center;
            font-size: 2.2em;
        }
        
        h2 {
            color: #16316a;
            font-size: 1.4em;
            margin-top: 30px;
            border-left: 5px solid #16316a;
            padding-left: 15px;
        }
        
        .metadata {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
        }
        
        .incident-header {
            background-color: #e9ecef;
            padding: 12px;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 20px;
            border-left: 4px solid #16316a;
        }
        
        ul {
            margin: 10px 0;
            padding-left: 25px;
        }
        
        li {
            margin: 8px 0;
        }
        
        .data-incomplete {
            color: red;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        th, td {
            border: 1px solid #bbb;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #16316a;
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .monospace {
            font-family: monospace;
            font-weight: bold;
        }
        
        .recommendations ul {
            list-style-type: disc;
            padding-left: 30px;
        }
        
        .recommendations li {
            margin: 12px 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Strategic Crime Reduction Briefing</h1>
    
    <div class="metadata">
        Reporting Period: July 8-13, 2025 (Week 28)
    </div>
`;

// Generate crime sections
let sectionNumber = 1;
const summaryData = [];

for (const [crimeType, incidents] of Object.entries(crimeGroups)) {
    htmlContent += `\n    <h2>${sectionNumber}.